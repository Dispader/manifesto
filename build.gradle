buildscript {
    repositories.jcenter()
    dependencies.classpath 'org.ajoberstar:grgit:1.7.0'
}
apply plugin: 'war'

class Version {

    static getImplementation() {
        org.ajoberstar.grgit.Grgit.open().describe { } ?: ''
    }

    static getSpecification() {
        Version.implementation?.split(/-\d/)[0] ?: ''
    }

}

task manifestJar(type: Jar) {
    manifest {
        attributes( 'Specification-Title': project.name,
                    'Specification-Version': Version.specification,
                    'Implementation-Title': project.name,
                    'Implementation-Version': Version.implementation,
                    'Implementation-Timestamp': new Date() )
    }
}

task manifestWar(type: War) {
    manifest {
        attributes( 'Specification-Title': project.name,
                    'Specification-Version': Version.specification,
                    'Implementation-Title': project.name,
                    'Implementation-Version': Version.implementation,
                    'Implementation-Timestamp': new Date() )
    }

}
